<template>
  <div class="container">
    <div class="row">
      <div class="col">
        <img src="@/assets/20221213_KAI로고.png" style="width: 27%" alt="" />
      </div>
      <div class="col">
        <div class="text-center">
          <h1 class="fw-bold">심 사 계 획 서</h1>
          <h4 class="fw-bold">( 최초심사 )</h4>
          <p>www.kaicert.co.kr</p>
        </div>
      </div>
      <div class="col">
        <img
          src="@/assets/IAS로고.png"
          style="width: 27%; float: right"
          alt=""
        />
      </div>
    </div>

    <h6 class="fw-bold">
      <!-- <i class="fa-solid fa-square-caret-right" style="color: blueviolet"></i> -->
      I. 인증고객정보
    </h6>
    <!-- table -->
    <table class="table text-center table-bordered table-sm">
      <tbody class="table-group-divider">
        <tr>
          <th style="width: 15%" class="bg-light">고객명</th>
          <td style="width: 25%">(주)비티씨씨큐</td>
          <th style="width: 15%" class="bg-light">대표자</th>
          <td style="width: 10%">박건준</td>
          <th style="width: 15%" class="bg-light">심사번호</th>
          <td style="width: 20%">22QEO10411</td>
        </tr>
        <tr>
          <th style="width: 10%" rowspan="3" class="bg-light">사업장 주소</th>
          <td style="width: 30%" colspan="3" class="text-start">
            사업장1: 인천광역시 서구 대평로 36-1(연희동)
          </td>
          <!-- <th style="width: 10%">대표자</th> -->
          <!-- <td style="width: 20%"></td> -->
          <th style="width: 10%" class="bg-light">담당부서</th>
          <td style="width: 20%">관리팀</td>
        </tr>
        <tr>
          <!-- <th style="width: 10%">사업장 주소</th> -->
          <td style="width: 30%" colspan="3" class="text-start">사업장2:</td>
          <!-- <th style="width: 10%">대표자</th> -->
          <!-- <td style="width: 20%"></td> -->
          <th style="width: 10%" class="bg-light">담당자</th>
          <td style="width: 20%">박건우/대표이사</td>
        </tr>
        <tr>
          <!-- <th style="width: 10%">사업장 주소</th> -->
          <td style="width: 30%" colspan="3" class="text-start">사업장3:</td>
          <!-- <th style="width: 10%">대표자</th> -->
          <!-- <td style="width: 20%"></td> -->
          <th style="width: 10%" class="bg-light">이메일</th>
          <td style="width: 20%">ecodrill@ecodrill.co.kr</td>
        </tr>
        <tr>
          <th style="width: 10%" class="bg-light">인증범위</th>
          <td style="width: 30%" colspan="3">친환경 천공장비의 판매</td>
          <!-- <th style="width: 10%">대표자</th>
          <td style="width: 20%"></td>-->
          <th style="width: 10%" class="bg-light">IAF 코드</th>
          <td style="width: 30%" colspan="5">29</td>
        </tr>
        <!-- <tr>
          <th style="width: 10%" class="bg-light">IAF 코드</th>
          <td style="width: 30%" colspan="5">29</td>
          <th style="width: 10%">대표자</th>
          <td style="width: 20%"></td>
          <th style="width: 10%">이메일</th>
          <td style="width: 20%">ecodrill@ecodrill.co.kr</td>
        </tr> -->
      </tbody>
    </table>

    <!-- 심사보고서 -->

    <!-- <div class="text-center mb-5">
      <h3 class="fw-bold">심 사 보 고 서</h3>
      <span>(2단계)</span>
    </div> -->
    <h6 class="fw-bold">II. 심사표준</h6>
    <table class="table text-center table-sm">
      <tbody class="table-group-divider">
        <tr>
          <th>ISO9001:2015, ISO14001:2015, ISO45001:2018</th>
        </tr>
      </tbody>
    </table>

    <h6 class="fw-bold">III. 심사목적</h6>
    <table class="table table-sm">
      <tbody>
        <tr>
          <p style="font-size: small">
            <ins>[1단계 심사]</ins><br />
            <b>1)</b>고객의 경영시스템을 문화화한 정보 검토, 고객의 위치 및
            사업장별 상태를 평가하고, <b>2)</b>2단계 심사를 위한 준비상태를
            결정하기 위한 고객 구성원들과의 협의, <b>3)</b>신청한 경영시스템
            표준 요구사항, 특히 경영시스템의 주요 성과 또는 중대한 측면의 파악,
            프로세스, 목표 및 운영과 관련된 조직의 상태 및 이해정도를 검토,
            <b>4)</b>경영시스템의 인증범위와 관련된 필수 정보 획득(- 고객사업장,
            사용된 프로세스 및 장비, 수립된 시스템의 관리수준, 적용가능한 법적,
            규제적 요구사항), <b>5)</b>2단계 심사를 위한 자원의 배정에 대해
            검토하고, 2단계 심사의 세부사항에 대하여 고객과 협의,
            <b>6)</b>중대한 측면과 관련하여 조직의 경영시스템 및 사업장 운영에
            대하여 충분히 이해함으로써 2단계 심사 계획을 위한 중점사항을 제공,
            <b>7)</b>내부심사와 경영검토를 계획 및 수행하고 있는지의 여부를
            평가하고, 고객의 경영시스템 실행 수준이 2단계 심사를 받을 준비가
            되었음을 평가
          </p>
        </tr>
        <tr>
          <p style="font-size: small">
            <ins>[2단계 심사]</ins><br />
            <b>1)최초심사</b> - 경영시스템의 실행 및 효과성을 평가,
            <b>2)사후심사</b> - 경영시스템의 지속적 실행 검증, 변경사항 검토를
            통한 지속적 적합성 여부 확인, <b>3)갱신심사</b> - 경영시스템 전반의
            지속적 적합성, 효과성 확인 및 인증범위에 대해 경영시스템의 관련성 및
            적용성 확인
          </p>
        </tr>
      </tbody>
    </table>

    <h6 class="fw-bold">VI. 심사정보[1단계]</h6>
    <table class="table text-center table-bordered table-sm">
      <tbody class="table-group-divider">
        <tr>
          <th style="width: 11%" class="bg-light">심사유형</th>
          <td style="width: 11%" colspan="4">최초심사</td>
          <!-- <th style="width: 11%" class="bg-light"></th>
          <td style="width: 11%"></td>
          <th style="width: 11%" class="bg-light"></th> -->
          <th style="width: 11%" class="bg-light" colspan="2">심사구분</th>
          <!-- <td style="width: 11%"></td> -->
          <td style="width: 11%" colspan="2">통합심사</td>
          <!-- <td style="width: 11%"></td> -->
        </tr>
        <tr>
          <th style="width: 11%" class="bg-light">심사일자</th>
          <td style="width: 11%" colspan="4">2022-11-22 ~ 2022-11-22</td>
          <!-- <th style="width: 11%" class="bg-light"></th>
          <td style="width: 11%"></td>
          <th style="width: 11%" class="bg-light"></th> -->
          <th style="width: 11%" colspan="2" class="bg-light">심사 M/D</th>
          <!-- <td style="width: 11%"></td> -->
          <td style="width: 11%" colspan="2">1.0 MD</td>
          <!-- <td style="width: 11%"></td> -->
        </tr>
        <tr>
          <th style="width: 11%" rowspan="2" class="bg-light">심사팀구성</th>
          <th style="width: 11%" class="bg-light">역할</th>
          <th style="width: 11%" class="bg-light">소속</th>
          <th style="width: 11%" class="bg-light">성명</th>
          <th style="width: 11%" class="bg-light">코드</th>
          <th style="width: 11%" class="bg-light">역할</th>
          <th style="width: 11%" class="bg-light">소속</th>
          <th style="width: 11%" class="bg-light">성명</th>
          <th style="width: 11%" class="bg-light">코드</th>
        </tr>
        <tr>
          <!-- <th style="width: 11%" class="bg-light">심사팀구성</th> -->
          <td style="width: 11%">심사팀장</td>
          <td style="width: 11%">KAI</td>
          <td style="width: 11%">박성훈</td>
          <td style="width: 11%">29</td>
          <td style="width: 11%">심사팀원</td>
          <td style="width: 11%">KAI</td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
        </tr>
      </tbody>
    </table>

    <h6 class="fw-bold">V. 심사정보[2단계]</h6>
    <table class="table text-center table-bordered table-sm">
      <tbody class="table-group-divider">
        <tr>
          <th style="width: 11%" class="bg-light">심사유형</th>
          <td style="width: 11%" colspan="4">최초심사</td>
          <!-- <th style="width: 11%" class="bg-light"></th>
          <td style="width: 11%"></td>
          <th style="width: 11%" class="bg-light"></th> -->
          <th style="width: 11%" class="bg-light" colspan="2">심사구분</th>
          <!-- <td style="width: 11%"></td> -->
          <td style="width: 11%" colspan="2">통합심사</td>
          <!-- <td style="width: 11%"></td> -->
        </tr>
        <tr>
          <th style="width: 11%" class="bg-light">심사일자</th>
          <td style="width: 11%" colspan="4">2022-11-22 ~ 2022-11-22</td>
          <!-- <th style="width: 11%" class="bg-light"></th>
          <td style="width: 11%"></td>
          <th style="width: 11%" class="bg-light"></th> -->
          <th style="width: 11%" colspan="2" class="bg-light">심사 M/D</th>
          <!-- <td style="width: 11%"></td> -->
          <td style="width: 11%" colspan="2">1.0 MD</td>
          <!-- <td style="width: 11%"></td> -->
        </tr>
        <tr>
          <th style="width: 11%" rowspan="3" class="bg-light">심사팀구성</th>
          <th style="width: 11%" class="bg-light">역할</th>
          <th style="width: 11%" class="bg-light">소속</th>
          <th style="width: 11%" class="bg-light">성명</th>
          <th style="width: 11%" class="bg-light">코드</th>
          <th style="width: 11%" class="bg-light">역할</th>
          <th style="width: 11%" class="bg-light">소속</th>
          <th style="width: 11%" class="bg-light">성명</th>
          <th style="width: 11%" class="bg-light">코드</th>
        </tr>
        <tr>
          <!-- <th style="width: 11%" class="bg-light">심사팀구성</th> -->
          <td style="width: 11%">심사팀장</td>
          <td style="width: 11%">KAI</td>
          <td style="width: 11%">박성훈</td>
          <td style="width: 11%">29</td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
        </tr>
        <tr>
          <!-- <th style="width: 11%" class="bg-light">심사팀구성</th> -->
          <td style="width: 11%">심사팀원</td>
          <td style="width: 11%">KAI</td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
          <td style="width: 11%"></td>
        </tr>
      </tbody>
    </table>

    <!-- 심사비 -->
    <h6 class="fw-bold">VI. 심사비</h6>
    <table class="table text-center table-bordered table-sm">
      <tbody class="table-group-divider">
        <tr>
          <th style="width: 11%" class="bg-light" rowspan="3">심사비</th>
          <th style="width: 11%" class="bg-light">신청비</th>
          <td style="width: 11%">원</td>
          <th style="width: 11%" class="bg-light">심사비</th>
          <td style="width: 11%">1,200,000원</td>
          <th style="width: 11%" class="bg-light" rowspan="2">비고</th>
          <td style="width: 11%" colspan="3"></td>
          <!-- <td style="width: 11%"></td> -->
          <!-- <td style="width: 11%"></td> -->
        </tr>
        <tr>
          <!-- <th style="width: 11%" class="bg-light">심사비</th> -->
          <th style="width: 11%" class="bg-light">출장비</th>
          <td style="width: 11%">원</td>
          <th style="width: 11%" class="bg-light">합계(VAT포함)</th>
          <th style="width: 11%">1,200,000원</th>
          <!-- <th style="width: 11%" class="bg-light">비고</th> -->
          <td style="width: 11%" colspan="3"></td>
          <!-- <td style="width: 11%"></td> -->
          <!-- <td style="width: 11%"></td> -->
        </tr>
        <tr>
          <!-- <th style="width: 11%" class="bg-light">심사비</th> -->
          <th style="width: 11%" colspan="6">
            납부계좌정보: (기업은행) / 988-012789-04-012 / 케이에이아이인증원
          </th>
          <!-- <td style="width: 11%">원</td>
          <th style="width: 11%" class="bg-light">심사비</th>
          <td style="width: 11%">1,200,000원</td>
          <th style="width: 11%" class="bg-light">비고</th>
          <td style="width: 11%" colspan="3"></td> -->
          <!-- <td style="width: 11%"></td> -->
          <!-- <td style="width: 11%"></td> -->
        </tr>
      </tbody>
      <small>
        ▶심사팀에는 기술전문가, 심사훈련자(심사원 양성), 검증심사원(심사원
        검증), 인증심사원(입회평가)이 참석할 수 있으나, 이에 따라 심사 시간이
        추가되거나 비용이 발생하지않습니다.
      </small>
    </table>

    <!-- <h6 class="fw-bold">VII. 의사소통 정보</h6> -->
    <!-- <table class="table text-center table-sm"> -->
    <!-- <tbody class="table-group-divider"> -->
    <!-- <tr> -->
    <p>
      ▶우리 인증원은 귀사의 경영시스템 향상을 위하여 최선을 다하겠습니다. 인증
      심사와 관련하여 궁금한 사항은 인증원으로(service@kaicert.com) 문의 주시면
      상세하게 안내드리겠습니다.
    </p>
    <!-- </tr> -->
    <!-- </tbody> -->
    <!-- </table> -->
    <img
      src="@/assets/stamp_KAI.png"
      alt=""
      style="width: 90px; position: absolute; left: 58%; top: 90 %"
    />

    <div class="text-center fw-bold">
      <p>2022년 12월 13일</p>
      <h2 class="fw-bold">케이에이아이인증원</h2>
    </div>

    <div class="text-end d-print-none">
      <button type="button" class="btn btn-primary" @click="printApplication">
        인쇄
      </button>
      <button
        type="button"
        class="btn btn-secondary ms-2"
        @click="goToCertDetail"
      >
        목록
      </button>
    </div>
  </div>
</template>

<script>
export default {
  computed: {
    user() {
      const data = this.$store.state.user
      console.log(data)
      console.log(data.userInfo.name, data.userInfo.email)
      return data

      // return this.$store.state.user.user
      // return this.$store.user.userInfo
    }
  },
  components: {},
  data() {
    return {
      id: '',
      // searchName: '',
      imgSrc: '',
      imgExt: ''
    }
  },
  created() {
    this.id = this.$route.query.id
    console.log(this.id)
  },
  mounted() {
    // console.log(this.user.userInfo.email)
    if (this.user.userInfo.email === undefined) {
      alert('로그인이 필요합니다.')
      this.$router.push({ path: '/login' })
    }
  },
  unmounted() {},
  methods: {
    async getCertListByBizNo() {
      // console.log(this.id)
      const dbAuditDataByBizNo = await this.$get(
        // `/api/customer/cert/list/${this.id}`
        `http://localhost:3000/api/customer/cert/list/cid/${this.id}`
      )
      // const dbAuditDataByCustomer = await this.$post(
      //   `/api/customer/cert/list/${this.id}`
      // )
      // const dbAuditDataByCustomer = await this.$get('/api/customer/cert/list')
      console.log('DB에서 가져온 CertListByBizNo', dbAuditDataByBizNo)
      this.dbAuditInfo = dbAuditDataByBizNo
    },
    async getCustomer() {
      console.log(this.id)
      const dbData = await this.$get(
        `http://localhost:3000/api/customer/list/${this.id}`
      )
      console.log(this.customer)
      console.log('db에서 가져온 data : ', dbData)

      this.customer.name_ko = dbData.name_ko
      this.customer.customer_type = dbData.customer_type
      this.customer.scope_ko = dbData.scope_ko
      this.customer.employee_count = dbData.employee_count
      this.customer.auditor_email = dbData.auditor_email
      this.customer.auditor_name = dbData.auditor_name
      this.customer.business_no = dbData.business_no
      this.customer.customer_id = dbData.customer_id
      this.customer.iaf_code = JSON.parse(dbData.iaf_code)
    },
    printApplication() {
      window.print()
    },

    execDaumPostcode() {
      // @click을 사용할 때 함수는 이렇게 작성해야 한다.
      new window.daum.Postcode({
        oncomplete: (data) => {
          console.log(data)
          if (this.customer.address_extra !== '') {
            this.customer.address_extra = ''
          }
          if (data.userSelectedType === 'R') {
            // 사용자가 도로명 주소를 선택했을 경우
            this.customer.address_ko = data.roadAddress
          } else {
            // 사용자가 지번 주소를 선택했을 경우(J)
            this.customer.address_ko = data.jibunAddress
          }

          // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
          if (data.userSelectedType === 'R') {
            // 법정동명이 있을 경우 추가한다. (법정리는 제외)
            // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
            if (data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
              this.customer.address_reference += data.bname
            }
            // 건물명이 있고, 공동주택일 경우 추가한다.
            if (data.buildingName !== '' && data.apartment === 'Y') {
              this.customer.address_reference +=
                this.customer.address_reference !== ''
                  ? `, ${data.buildingName}`
                  : data.buildingName
            }
            // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
            if (this.customer.address_detail !== '') {
              this.customer.address_detail = `(${this.customer.address_detail})`
            }
          } else {
            this.customer.address_reference = ''
          }

          // 영문주소
          this.customer.address_en = data.addressEnglish

          // 우편번호를 입력한다.
          this.customer.postcode = data.zonecode
        }
      }).open()
    },
    async uploadFile(files) {
      const r = await this.$upload('/api/upload/file', files[0])
      console.log(r)
      this.imgSrc = `http://localhost:3000/static/uploads/${r.filename}`
      this.customer.img_license = r.filename
      this.customer.img_license_originalname = r.originalname
      this.imgExt = r.mimetype
      console.log(this.customer.img_license)
      console.log(this.customer.img_license_originalname)
      console.log(this.imgExt)
    },
    async doSave() {
      // if (this.customer.certification_type === '') {
      //   return this.$swal('인증유형을 선택해주세요.')
      // }
      // if (this.customer.name_ko === '') {
      //   return this.$swal('국문회사명을 입력하세요.')
      // }
      // if (this.customer.name_en === '') {
      //   return this.$swal('영문회사명을 입력하세요.')
      // }
      // if (this.customer.business_no === '') {
      //   return this.$swal('사업자등록번호를 입력하세요.')
      // }
      // if (this.customer.ceo_name === '') {
      //   return this.$swal('대표자명을 입력하세요.')
      // }
      // if (this.customer.email === '') {
      //   return this.$swal('대표이메일을 입력하세요.')
      // }
      // if (this.customer.phone === '') {
      //   return this.$swal('대표전화번호를 입력하세요.')
      // }
      // if (this.customer.address_ko === '') {
      //   return this.$swal('주소를 입력하세요.')
      // }
      // if (this.customer.contact_name === '') {
      //   return this.$swal('자명/직위를 입력하세요.')
      // }
      // if (this.customer.contact_phone === '') {
      //   return this.$swal('자 연락처를 입력하세요.')
      // }
      // if (this.customer.contact_email === '') {
      //   return this.$swal('자 이메일을 입력하세요.')
      // }
      // if (this.customer.organization_scope === '') {
      //   return this.$swal('조직의 범위를 입력하세요.')
      // }
      // if (this.customer.certification_standard === '') {
      //   return this.$swal('신청 인증표준을 입력하세요.')
      // }
      // if (this.customer.design === '') {
      //   return this.$swal('설계/개발 유무를 입력하세요.')
      // }
      // if (this.customer.scope_ko === '') {
      //   return this.$swal('국문 인증범위를 입력하세요.')
      // }

      this.$swal({
        title: '보고서를 생성 하시겠습니까?',
        // text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        cancelButtonText: '취소',
        confirmButtonText: '저장'
      }).then(async (result) => {
        if (result.isConfirmed) {
          const loader = this.$loading.show({ canCancel: false })

          const r = await this.$post('/api/report/s1', {
            param: {
              leader: this.auditTeam.leader,
              auditor1: this.auditTeam.auditor1,
              auditor2: this.auditTeam.auditor2,
              auditor3: this.auditTeam.auditor3,
              tech_expert: this.companions.tech_expert,
              trainee1: this.companions.trainee1,
              trainee2: this.companions.trainee2,
              trainee3: this.companions.trainee3,
              biz_area: this.checkpoint.biz_area,
              reliability: this.checkpoint.reliability,
              issue: this.checkpoint.issue,
              biz_status: this.checkpoint.biz_status,
              needs: this.checkpoint.needs,
              scope: this.checkpoint.scope,
              quality_risk: this.checkpoint.quality_risk,
              env_risk: this.checkpoint.env_risk,
              safety_risk: this.checkpoint.safety_risk,
              regal: this.checkpoint.regal,
              policy: this.checkpoint.policy,
              goal: this.checkpoint.goal,
              internal_audit: this.checkpoint.internal_audit,
              management_review: this.checkpoint.management_review,
              understanding_level: this.checkpoint.understanding_level,
              workspace: this.checkpoint.workspace,
              exclusion: this.checkpoint.exclusion,
              worker_count: this.checkpoint.worker_count,
              s2md: this.checkpoint.s2md,
              guider: this.checkpoint.guider,
              place: this.checkpoint.place,
              precautions: this.checkpoint.precautions,
              site_address: this.checkpoint.site_address,
              visit_time: this.checkpoint.visit_time,
              contact: this.checkpoint.contact,
              findings_array: JSON.stringify(this.rows)
              // findings: JSON.stringify(this.row.findings),
              // findings_content: JSON.stringify(this.row.findings_content),
              // findings_standard: JSON.stringify(this.row.findings_standard)
            }
          })

          loader.hide()

          console.log(r)

          if (r.status === 200) {
            this.$swal('1단계 심사보고서가 저장되었습니다.')
            this.$router.push({
              path: '/customer/list',
              query: { customer_id: r.data.insertId }
            })
          }
        }
      })
    },
    goToList() {
      this.$router.push({ path: '/customer/list' })
    },
    goToCertDetail() {
      this.$router.push({
        path: '/customer/cert/detail',
        query: { audit_no: this.id }
      })
    }
  }
}
</script>
<style scoped>
/* textarea {
  font-size: 14px;
}
table {
  font-size: 14px;
} */
@media print {
  /* header,
  footer,
  .no-print {
    display: none;
  } */
  @page {
    size: A4;
    margin-top: 0;
    margin-bottom: 0;
  }
}
</style>
